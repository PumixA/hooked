generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model categories {
  id       String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  label    String     @db.VarChar(50)
  icon_key String?    @db.VarChar(50)
  projects projects[]
}

model materials {
  id                   String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id              String?             @db.Uuid
  category_type        String              @db.VarChar(20)
  name                 String              @db.VarChar(100)
  size                 String?             @db.VarChar(20)
  brand                String?             @db.VarChar(100)
  material_composition String?             @db.VarChar(100)
  updated_at           DateTime?           @default(now()) @db.Timestamptz(6)
  users                users?              @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  project_materials    project_materials[]
}

model notes {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  project_id String?   @db.Uuid
  content    String?
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  updated_at DateTime? @default(now()) @db.Timestamptz(6)
  projects   projects? @relation(fields: [project_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model photos {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  project_id String?   @db.Uuid
  file_path  String    @db.VarChar(255)
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  projects   projects? @relation(fields: [project_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model project_materials {
  project_id  String    @db.Uuid
  material_id String    @db.Uuid
  materials   materials @relation(fields: [material_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  projects    projects  @relation(fields: [project_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([project_id, material_id])
}

model projects {
  id             String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id        String?   @db.Uuid
  category_id    String?   @db.Uuid
  title          String    @db.VarChar(150)
  status         String?   @default("in_progress") @db.VarChar(20)
  current_row    Int?      @default(0)
  goal_rows      Int?
  increment_step Int?      @default(1)
  total_duration Int?      @default(0)
  start_date     DateTime? @default(now()) @db.Timestamptz(6)
  end_date       DateTime? @db.Timestamptz(6)
  created_at     DateTime? @default(now()) @db.Timestamptz(6)
  updated_at     DateTime? @default(now()) @db.Timestamptz(6)

  // Relations
  notes             notes[]
  photos            photos[]
  project_materials project_materials[]
  sessions          sessions[]

  categories categories? @relation(fields: [category_id], references: [id], onUpdate: NoAction)
  users      users?      @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model sessions {
  id               String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  project_id       String?   @db.Uuid
  start_time       DateTime  @db.Timestamptz(6)
  end_time         DateTime? @db.Timestamptz(6)
  duration_seconds Int?      @default(0)

  projects projects? @relation(fields: [project_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model users {
  id            String      @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email         String      @unique @db.VarChar(255)
  password_hash String      @db.VarChar(255)
  role          String?     @default("user") @db.VarChar(20)
  theme_pref    String?     @default("dark") @db.VarChar(20)
  created_at    DateTime?   @default(now()) @db.Timestamptz(6)
  updated_at    DateTime?   @default(now()) @db.Timestamptz(6)
  materials     materials[]
  projects      projects[]
}
